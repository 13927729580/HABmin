<rules>
    <rule>
        <name>MaximumToday</name>
        <label>Maximum item value since midnight</label>
        <itemtype>NumberItem</itemtype>
        <type>DerivedItem</type>
        <extension>_MaxToday</extension>
        <description></description>
        <trigger>Item %%ItemName%% changed or</trigger>
        <trigger>Time cron "0 0 0 * * ?" or</trigger>
        <trigger>System started</trigger>
        <action>postUpdate(%%DerivedName%%, %%ItemName%%.maximumSince(now.toDateMidnight).state)</action>
    </rule>
    <rule>
        <name>MinimumToday</name>
        <label>Minimum item value since midnight</label>
        <type>DerivedItem</type>
        <itemtype>NumberItem</itemtype>
        <extension>_MinToday</extension>
        <description></description>
        <trigger>Item %%Itemlabel%% changed or</trigger>
        <trigger>Time cron "0 0 0 * * ?" or</trigger>
        <trigger>System started</trigger>
        <action>postUpdate(%%DerivedName%%, %%ItemName%%.minimumSince(now.toDateMidnight).state)</action>
    </rule>
    <rule>
        <name>ChangeToday</name>
        <label>Change since midnight</label>
        <type>DerivedItem</type>
        <itemtype>NumberItem</itemtype>
        <extension>_ChangeToday</extension>
        <description></description>
        <trigger>Item %%ItemName%% changed or</trigger>
        <trigger>Time cron "0 * * * * ?" or</trigger>
        <trigger>System started</trigger>
        <action>var Number valNow = %%ItemName%%.state</action>
        <action>var Number valThen = %%ItemName%%.minimumSince(now.toDateMidnight(24)).state</action>
        <action>var Number valDif = valNow - valThen</action>
        <action>postUpdate(%%DerivedName%%, valDif)</action>
    </rule>
    <rule>
        <name>Change1Hour</name>
        <label>Change in past 1 hour</label>
        <type>DerivedItem</type>
        <itemtype>NumberItem</itemtype>
        <description></description>
        <extension>_ChangeLastHour</extension>
        <trigger>Item %%ItemName%% changed or</trigger>
        <trigger>Time cron "0 * * * * ?" or</trigger>
        <trigger>System started</trigger>
        <action>var Number valNow = %%ItemName%%.state</action>
        <action>var Number valThen = %%ItemName%%.minimumSince(now.minusHours(6)).state</action>
        <action>var Number valDif = valNow - valThen</action>
        <action>postUpdate(%%DerivedName%%, valDif)</action>
    </rule>
    <rule>
        <name>Change6Hour</name>
        <label>Change in past 6 hours</label>
        <type>DerivedItem</type>
        <itemtype>NumberItem</itemtype>
        <description></description>
        <extension>_ChangeLast6Hours</extension>
        <trigger>Item %%ItemName%% changed or</trigger>
        <trigger>Time cron "0 * * * * ?" or</trigger>
        <trigger>System started</trigger>
        <action>var Number valNow = %%ItemName%%.state</action>
        <action>var Number valThen = %%ItemName%%.minimumSince(now.minusHours(6)).state</action>
        <action>var Number valDif = valNow - valThen</action>
        <action>postUpdate(%%DerivedName%%, valDif)</action>
    </rule>
    <rule>
        <name>Change24Hour</name>
        <label>Change in past 24 hours</label>
        <type>DerivedItem</type>
        <itemtype>NumberItem</itemtype>
        <description></description>
        <extension>_ChangeLast24Hours</extension>
        <trigger>Item %%ItemName%% changed or</trigger>
        <trigger>Time cron "0 * * * * ?" or</trigger>
        <trigger>System started</trigger>
        <action>var Number valNow = %%ItemName%%.state</action>
        <action>var Number valThen = %%ItemName%%.minimumSince(now.minusHours(24)).state</action>
        <action>var Number valDif = valNow - valThen</action>
        <action>postUpdate(%%DerivedName%%, valDif)</action>
    </rule>

    <rule>
        <name>Maximum1Hour</name>
        <label>Maximum item value - updated every 1 hour</label>
        <type>DerivedItem</type>
        <itemtype>NumberItem</itemtype>
        <description></description>
        <extension>_MaxHour</extension>
        <trigger>Item %%ItemName%% changed or</trigger>
        <trigger>Time cron "0 0 * * * ?" or</trigger>
        <trigger>System started</trigger>
        <action>postUpdate(%%DerivedName%%, %%ItemName%%.maximumSince(now.minusHours(1)).state)</action>
    </rule>
    <rule>
        <name>Minimum1Hour</name>
        <label>Minimum item value - updated every 1 hour</label>
        <type>DerivedItem</type>
        <itemtype>NumberItem</itemtype>
        <description></description>
        <extension>_MinHour</extension>
        <trigger>Item %%ItemName%% changed or</trigger>
        <trigger>Time cron "0 0 * * * ?" or</trigger>
        <trigger>System started</trigger>
        <action>postUpdate(%%DerivedName%%, %%ItemName%%.minimumSince(now.minusHours(1)).state)</action>
    </rule>

    <rule>
        <name>PowerConsumptionNow</name>
        <label>Calculate current power consumption</label>
        <type>DerivedItem</type>
        <itemtype>SwitchItem</itemtype>
        <itemtype>DimmerItem</itemtype>
        <description>Calculates the power consumed by the item given a user specified maximum power</description>
        <extension>_Watts</extension>
        <trigger>Item %%ItemName%% changed</trigger>
        <action>var Number valState = %%ItemName%%.state</action>
        <action>var Number valWatts = valState * %%UserWatts%%</action>
        <action>postUpdate(postUpdate(%%DerivedName%%, valWatts)</action>
        <variable>
            <name>UserWatts</name>
            <label>User defined Watts</label>
            <description>Maximum power the item consumes when ON</description>
            <scope>Item</scope>
        </variable>
    </rule>

</rules>

